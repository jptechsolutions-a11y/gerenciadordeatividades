<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JProjects | Gerenciador de Projetos</title>
    <link rel="icon" href="icon.png" type="image/png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#011627">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100">

    <!-- ... (Modal de Onboarding - Sem alterações) ... -->
    <div id="teamOnboardingModal" class="modal-overlay" style="display: none; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);">
        <!-- ... (Conteúdo do modal) ... -->
    </div>
    <!-- FIM DO MODAL DE ONBOARDING -->


    <!-- Este é o container principal do seu sistema -->
    <div id="appShell" class="h-screen flex flex-col" style="display: none;"> <!-- Inicia escondido, JS mostra -->

        <!-- 1. BARRA SUPERIOR (HEADER) -->
        <header id="topBar" class="flex-shrink-0">
            <!-- ... (Conteúdo da Barra Superior - Sem alterações) ... -->
            <div class="flex items-center gap-4">
                <button id="sidebarToggle" class="btn-icon">
                    <i data-feather="menu" class="h-5 w-5"></i>
                </button>
                <img src="icon.png" class="h-8 w-8" alt="Logo JP">
                <div class="separator"></div>
                <div id="teamSelector" class="relative">
                    <button id="teamSelectorButton" class="flex items-center gap-2 rounded-md hover:bg-gray-700 p-2 transition-colors"> 
                        <div class="flex flex-col text-left">
                            <span class="text-sm font-semibold text-white" id="topBarProjectName">Carregando...</span>
                            <span class="text-xs text-gray-400">JProjects</span>
                        </div>
                       <i data-feather="chevron-down" class="h-4 w-4 text-gray-400"></i>
                    </button>
                    <div id="teamSelectorMenu" class="dropdown-menu" style="width: 280px; top: 110%; background: #1e293b;">
                        <!-- ... (Conteúdo do seletor de time) ... -->
                    </div>
                </div>
            </div>
            <div class="flex-1 flex justify-center px-8">
                <input type="text" id="topBarSearch" placeholder="Buscar tarefas..." class="w-full max-w-md">
            </div>
            <div class="flex items-center gap-4">
                <button class="btn btn-success" onclick="openTaskModal(null)">
                    <i data-feather="plus" class="h-4 w-4 mr-2"></i>
                    <span class="hidden md:inline">Nova Tarefa</span>
                </button>
                <div class="separator"></div>
                <div id="profileDropdown" class="relative">
                    <button id="profileDropdownButton" class="flex items-center gap-2 rounded-full hover:bg-gray-700 p-1">
                        <img id="topBarUserAvatar" src="icon.png" class="w-8 h-8 rounded-full object-cover bg-gray-600">
                        <span id="topBarUserName" class="text-sm font-medium text-white hidden md:block">Usuário</span>
                        <i data-feather="chevron-down" class="h-4 w-4 text-gray-400 hidden md:block"></i>
                    </button>
                    <div id="profileDropdownMenu" class="dropdown-menu">
                        <!-- ... (Conteúdo do dropdown de perfil) ... -->
                    </div>
                </div>
            </div>
        </header>

        <!-- Container para Sidebar + Main Content -->
        <div id="mainSystem" class="flex flex-1 overflow-hidden">

            <!-- 2. BARRA LATERAL (SIDEBAR) -->
            <aside class="sidebar">
                <nav class="p-2 pt-4">
                    <!-- Item "Projetos (Lista)" movido para cima e renomeado -->
                    <a href="#lista" class="nav-item" title="Projetos" onclick="showView('listView', this)">
                        <i data-feather="list" class="h-5 w-5 mr-3"></i> <span class="nav-text">Projetos</span>
                    </a>
                    <a href="#dashboard" class="nav-item" title="Dashboard" onclick="showView('dashboardView', this)">
                        <i data-feather="trending-up" class="h-5 w-5 mr-3"></i> <span class="nav-text">Dashboard</span>
                    </a>
                    <!-- Renomeado para "Kanban" -->
                    <a href="#projetos" class="nav-item" title="Kanban" onclick="showView('projetosView', this)">
                        <i data-feather="trello" class="h-5 w-5 mr-3"></i> <span class="nav-text">Kanban</span>
                    </a>
                    <a href="#timeline" class="nav-item" title="Timeline" onclick="showView('timelineView', this)">
                        <i data-feather="git-commit" class="h-5 w-5 mr-3"></i> <span class="nav-text">Timeline</span>
                    </a>
                    <a href="#calendario" class="nav-item" title="Calendário & Gantt" onclick="showView('calendarioView', this)">
                        <i data-feather="calendar" class="h-5 w-5 mr-3"></i> <span class="nav-text">Calendário & Gantt</span>
                    </a>
                    <a href="#notas" class="nav-item" title="Bloco de Notas" onclick="showView('notasView', this)">
                        <i data-feather="edit-3" class="h-5 w-5 mr-3"></i> <span class="nav-text">Bloco de Notas</span>
                    </a>

                    <div class="mt-4 border-t border-gray-700 pt-2">
                        <span class="p-3 text-xs font-semibold text-gray-500 uppercase nav-text">Administração</span>
                    </div>

                    <a href="#time" class="nav-item" title="Gerenciar Time" onclick="showView('timeView', this)">
                        <i data-feather="users" class="h-5 w-5 mr-3"></i> <span class="nav-text">Gerenciar Time</span>
                    </a>
                    <a href="#perfil" class="nav-item" title="Meu Perfil" onclick="showView('perfilView', this)">
                        <i data-feather="user" class="h-5 w-5 mr-3"></i> <span class="nav-text">Meu Perfil</span>
                    </a>
                </nav>
            </aside>

            <!-- 3. CONTEÚDO PRINCIPAL (MAIN) -->
            <main id="mainContent" class="main-content">
                <!-- ATENÇÃO: O container foi removido daqui para que a tabela ocupe 100% da largura -->

                <!-- #dashboardView -->
                <div id="dashboardView" class="view-content active">
                    <div class="container mx-auto px-6 py-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">Dashboard de Produtividade</h1>
                        <!-- ... (Conteúdo do Dashboard - Sem alterações) ... -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="stat-card-dash"><span class="stat-number" id="dashTotalTasks">0</span><span class="stat-label">Tarefas Ativas</span></div>
                            <div class="stat-card-dash"><span class="stat-number" id="dashCompletedTasks">0</span><span class="stat-label">Tarefas Concluídas (Mês)</span></div>
                            <div class="stat-card-dash"><span class="stat-number" id="dashDueTasks">0</span><span class="stat-label">Tarefas Vencendo Hoje</span></div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-lg shadow-md chart-card">
                                <h3 class="text-xl font-semibold mb-4">Progresso do Projeto (Gantt)</h3>
                                <div class="relative h-96"><canvas id="ganttChart"></canvas></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-md chart-card">
                                <h3 class="text-xl font-semibold mb-4">Tarefas por Status</h3>
                                <div class="relative h-96"><canvas id="statusChart"></canvas></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- #projetosView (Kanban) -->
                <div id="projetosView" class="view-content">
                    <div class="container mx-auto px-6 py-8">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-3xl font-bold text-gray-800">Quadro Kanban</h1>
                        </div>
                        <div id="kanbanBoard" class="kanban-container">
                            <div class="loading col-span-3"><div class="spinner"></div> Carregando quadro...</div>
                        </div>
                    </div>
                </div>

                <!-- #listView (Projetos - REFORMULADO) -->
                <div id="listView" class="view-content">
                    <!-- O container de padding foi movido para dentro da view -->
                    <div class="container mx-auto px-6 py-8">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-3xl font-bold text-gray-800">Projetos</h1>
                            <button class="btn btn-success" onclick="openCreateProjectModal()">
                                <i data-feather="plus" class="h-4 w-4 mr-2"></i>
                                <span>Novo Projeto</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- A tabela agora fica fora do container para ter largura total -->
                    <div id="projectListContainer" class="project-table-container">
                        <!-- Botão de "Adicionar Novo Projeto" (Grupo) -->
                        <div class="project-table-controls">
                            <button class="btn btn-primary btn-small" onclick="openCreateProjectModal()">
                                <i data-feather="plus" class="h-4 w-4 mr-2"></i> Adicionar novo projeto
                            </button>
                        </div>

                        <!-- Tabela de Projetos (Estilo Monday) -->
                        <table class="project-table-dark">
                            <thead>
                                <tr>
                                    <!-- Coluna de Projeto/Tarefa -->
                                    <th style="min-width: 300px;">
                                        <i data-feather="layers" class="h-4 w-4 mr-2"></i> Projeto / Tarefa
                                    </th>
                                    <!-- Novas Colunas -->
                                    <th style="width: 150px;">
                                        <i data-feather="user" class="h-4 w-4 mr-2"></i> Responsável
                                    </th>
                                    <th style="width: 150px;">
                                        <i data-feather="bar-chart-2" class="h-4 w-4 mr-2"></i> Status
                                    </th>
                                    <th style="width: 200px;">
                                        <i data-feather="calendar" class="h-4 w-4 mr-2"></i> Timeline
                                    </th>
                                    <th style="width: 120px;">
                                        <i data-feather="clock" class="h-4 w-4 mr-2"></i> Esforço (h)
                                    </th>
                                    <th style="width: 150px;">
                                        <i data-feather="check-circle" class="h-4 w-4 mr-2"></i> Status Conclusão
                                    </th>
                                </tr>
                            </thead>
                            <!-- O JS vai popular isso aqui -->
                            <tbody id="projectListBody">
                                <!-- Exemplo de Header de Projeto (antigo Grupo) -->
                                <tr class="project-header-row" data-project-id="proj-1">
                                    <td colspan="6">
                                        <div class="project-header-content">
                                            <i data-feather="chevron-down" class="h-5 w-5 project-toggle"></i>
                                            <span class="project-priority-dot priority-alta"></span>
                                            <span class="project-title">Planejamento</span>
                                            <span class="project-task-count">(3 Tarefas)</span>
                                            <button class="btn-icon-task" onclick="openTaskModal(null, null, 'proj-1')">
                                                <i data-feather="plus" class="h-4 w-4"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Exemplo de Tarefa -->
                                <tr class="task-data-row" data-task-id="task-1" data-project-id="proj-1">
                                    <td class="task-title-cell">
                                        <i data-feather="file-text" class="h-4 w-4"></i> Tarefa 1
                                    </td>
                                    <td>
                                        <div class="person-cell" onclick="openAssigneeModal('task-1')">
                                            <img src="https://placehold.co/24x24/00D4AA/023047?text=JP" alt="Responsável">
                                            <span>Juliano Patrick</span>
                                        </div>
                                    </td>
                                    <td>
                                        <!-- Status Interativo -->
                                        <div class="status-box status-feito" onclick="openStatusModal('task-1', 'feito')">
                                            Feito
                                        </div>
                                    </td>
                                    <td>
                                        <!-- Timeline Interativa -->
                                        <div class="timeline-box" onclick="openTimelineModal('task-1')">
                                            <div class="timeline-bar" style="background-color: #00D4AA; width: 80%; margin-left: 10%;"></div>
                                            <span class="timeline-text">10 nov - 20 nov</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="effort-cell">10h</div>
                                    </td>
                                    <td>
                                        <div class="completion-status status-feito-a-tempo">
                                            <i data-feather="check" class="h-4 w-4"></i>
                                            <span>Feito a tempo</span>
                                        </div>
                                    </td>
                                </tr>
                                 <!-- Exemplo de Tarefa 2 -->
                                <tr class="task-data-row" data-task-id="task-2" data-project-id="proj-1">
                                    <td class="task-title-cell">
                                        <i data-feather="file-text" class="h-4 w-4"></i> Tarefa 2
                                    </td>
                                    <td>
                                        <div class="person-cell person-unassigned" onclick="openAssigneeModal('task-2')">
                                            <i data-feather="user-plus" class="h-4 w-4"></i>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="status-box status-em-andamento" onclick="openStatusModal('task-2', 'em-andamento')">
                                            Em Andamento
                                        </div>
                                    </td>
                                    <td>
                                        <div class="timeline-box" onclick="openTimelineModal('task-2')">
                                            <div class="timeline-bar" style="background-color: #F77F00; width: 30%; margin-left: 5%;"></div>
                                            <span class="timeline-text">5 nov - 15 nov</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="effort-cell">8h</div>
                                    </td>
                                    <td>
                                        <div class="completion-status status-atrasado">
                                            <i data-feather="clock" class="h-4 w-4"></i>
                                            <span>Atrasado</span>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Exemplo de "Adicionar Tarefa" -->
                                <tr class="add-task-row" data-project-id="proj-1">
                                    <td colspan="6">
                                        <div class="add-task-button-dark" onclick="openTaskModal(null, null, 'proj-1')">
                                            <i data-feather="plus" class="h-4 w-4"></i> Adicionar Tarefa
                                        </div>
                                    </td>
                                </tr>
                                
                                <!-- Exemplo Loading -->
                                <tr id="projectListLoading">
                                    <td colspan="6">
                                        <div class="loading"><div class="spinner"></div> Carregando projetos...</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- #timelineView -->
                <div id="timelineView" class="view-content">
                    <div class="container mx-auto px-6 py-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">Timeline de Atividades Recentes</h1>
                        <!-- ... (Conteúdo da Timeline - Sem alterações) ... -->
                    </div>
                </div>

                <!-- #calendarioView -->
                <div id="calendarioView" class="view-content">
                    <div class="container mx-auto px-6 py-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">Calendário de Entregas</h1>
                        <!-- ... (Conteúdo do Calendário - Sem alterações) ... -->
                    </div>
                </div>

                <!-- #notasView -->
                <div id="notasView" class="view-content">
                    <div class="container mx-auto px-6 py-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">Bloco de Notas</h1>
                        <!-- ... (Conteúdo das Notas - Sem alterações) ... -->
                    </div>
                </div>

                <!-- #timeView -->
                <div id="timeView" class="view-content">
                    <div class="container mx-auto px-6 py-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">Gerenciar Time</h1>
                        <!-- ... (Conteúdo do Time - Sem alterações) ... -->
                    </div>
                </div>

                <!-- #perfilView -->
                <div id="perfilView" class="view-content">
                     <div class="container mx-auto px-6 py-8">
                         <h1 class="text-3xl font-bold text-gray-800 mb-6">Meu Perfil</h1>
                        <!-- ... (Conteúdo do Perfil - Sem alterações) ... -->
                    </div>
                </div>

            </main>
        </div> <!-- Fim #mainSystem -->
    </div> <!-- Fim #appShell -->

    <!-- ====================================================== -->
    <!-- MODAIS (Pop-ups) -->
    <!-- ====================================================== -->
  
    <!-- #taskModal (Sem alterações estruturais, mas o JS vai usá-lo de forma diferente) -->
    <div id="taskModal" class="modal-overlay">
        <!-- ... (Conteúdo do Modal de Tarefa - Sem alterações) ... -->
    </div>

    <!-- #inviteModal (Sem alterações) -->
    <div id="inviteModal" class="modal-overlay">
        <!-- ... (Conteúdo do Modal de Convite - Sem alterações) ... -->
    </div>

    <!-- NOVO: Modal para Criar Projeto (antigo Grupo) -->
    <div id="projectModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
             <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Novo Projeto</h3>
                 <button class="text-gray-500 hover:text-red-600" onclick="closeModal('projectModal')">
                    <i data-feather="x" class="h-6 w-6"></i>
                </button>
            </div>
            <form id="projectForm">
                <div class="form-group mb-4">
                    <label for="projectName">Nome do Projeto:</label>
                    <input type="text" id="projectName" required class="w-full" placeholder="Ex: Lançamento do App v2">
                </div>
                <div class="form-group mb-4">
                    <label for="projectPriority">Prioridade:</label>
                    <select id="projectPriority" class="w-full">
                        <option value="baixa">Baixa</option>
                        <option value="media" selected>Média</option>
                        <option value="alta">Alta</option>
                        <option value="urgente">Urgente</option>
                    </select>
                </div>
                <div id="projectAlert" class="mt-4"></div>
                <div class="flex gap-4 mt-6 justify-end">
                     <button type="button" class="btn btn-secondary" onclick="closeModal('projectModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">
                         <i data-feather="plus-circle" class="h-4 w-4 mr-2"></i> Criar Projeto
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- NOVO: Modal genérico para Status (será populado pelo JS) -->
    <div id="statusModal" class="modal-overlay-transparent">
        <div id="statusModalContent" class="dropdown-menu-popup">
            <!-- Conteúdo será preenchido pelo JS -->
            <div class="status-option status-feito">Feito</div>
            <div class="status-option status-em-andamento">Em Andamento</div>
            <div class="status-option status-parado">Parado</div>
            <div class="status-option status-planejamento">Planejamento</div>
        </div>
    </div>


    <!-- Container de Notificações (Toasts) -->
    <div id="notificationContainer"></div>

    <!-- Scripts -->
    <script>
        // Configuração Inicial (Reutilizando sua API Proxy)
        const SUPABASE_PROXY_URL = '/api/proxy';
    </script>
    <script src="script.js"></script>
    <script>
        // Inicializar ícones e PWA
        feather.replace();
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => console.log('Service Worker registrado com sucesso:', registration))
                .catch(error => console.log('Falha ao registrar Service Worker:', error));
        }
    </script>
</body>
</html>

