<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JP Project Manager</title>

    <link rel="stylesheet" href="style.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script> 
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/locales/pt-br.global.min.js'></script>

</head>
<body class="bg-gray-100 font-sans">

    <div id="loginContainer" class="auth-container" style="background: var(--darker); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; position: relative;">
        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 180, 216, 0.1); backdrop-filter: blur(5px);"></div>
        <div class="main-login-grid" style="display: grid; grid-template-columns: 1fr 2fr; gap: 40px; max-width: 1400px; width: 90vw; z-index: 10;">
            <div class="auth-card" style="grid-column: span 1; background: white; padding: 50px 40px; border-radius: 16px; box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);">
                <div class="auth-header" style="text-align: center;">
                    <img src="teste.png" class="w-40 h-auto mb-6 mx-auto object-contain" alt="Logo JP Tech">
                    <h2 style="color: var(--dark); font-size: 1.8rem; font-weight: 700;">Acesso ao Sistema</h2>
                    <p style="color: var(--secondary); font-size: 1rem; margin-bottom: 30px;">Gerenciador de Projetos</p>
                </div>
                <form id="loginForm" class="auth-form">
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="email" style="display: none;">Usuário:</label>
                        <input type="text" id="email" placeholder="Usuário" required style="width: 100%; padding: 14px; border: 1px solid #ccc; border-radius: 8px;">
                    </div>
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="password" style="display: none;">Senha:</label>
                        <input type="password" id="password" placeholder="Senha" required style="width: 100%; padding: 14px; border: 1px solid #ccc; border-radius: 8px;">
                    </div>
                    <div class="form-group" id="filialSelectGroup" style="display: none; margin-bottom: 30px;">
                        <label for="filialSelect" class="block mb-1 font-semibold text-sm text-gray-700">Selecione o Time (Simulação de Filial):</label>
                        <select id="filialSelect" style="width: 100%; padding: 14px; border: 1px solid #ccc; border-radius: 8px;"></select>
                    </div>
                    <button type="submit" class="btn btn-primary w-full" style="background: var(--primary-gradient); color: white; padding: 14px; border-radius: 8px; font-weight: 700; font-size: 1rem;">ENTRAR</button>
                    <div class="mt-6 text-center text-sm">
                        <span class="text-gray-400">Usuários teste: joao/123 | maria/456 | carlos/789</span>
                    </div>
                </form>
                <div id="loginAlert" class="mt-4" style="text-align: center;"></div>
            </div>

            <div style="grid-column: span 1; display: grid; grid-template-rows: 1fr 1fr; gap: 40px;">
                 <div style="background: var(--secondary-gradient); color: white; padding: 40px; border-radius: 16px; box-shadow: 0 15px 50px rgba(0, 119, 182, 0.3); display: flex; flex-direction: column; justify-content: center;">
                    <div style="font-size: 2.5rem; font-weight: 800; line-height: 1.2;">CONTROLE TOTAL, VISÃO GERAL COMPLETA.</div>
                    <div style="font-size: 1.1rem; margin-top: 15px; font-weight: 400; opacity: 0.9;">Gerencie seus projetos com rastreabilidade de atividades, prazos e responsabilidade.</div>
                </div>
                 <div style="background: white; padding: 40px; border-radius: 16px; box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15); border-left: 5px solid var(--primary); display: flex; flex-direction: column; justify-content: center;">
                    <div style="color: var(--accent); font-weight: 700; margin-bottom: 10px;">PROCESSO DE GESTÃO</div>
                    <h3 style="font-size: 1.2rem; font-weight: 700; color: var(--dark); margin-bottom: 15px;">ETAPAS DO PROJETO</h3>
                    <ul style="list-style-type: none; margin: 0; padding: 0; font-size: 0.95rem; color: #555;">
                        <li style="margin-bottom: 5px;"><span style="color: var(--primary); font-weight: 600;">1. Criação:</span> Registre projeto, prioridade e responsáveis.</li>
                        <li style="margin-bottom: 5px;"><span style="color: var(--primary); font-weight: 600;">2. Cronograma:</span> Defina atividades com prazos e responsáveis por tarefa.</li>
                        <li style="margin-bottom: 5px;"><span style="color: var(--primary); font-weight: 600;">3. Execução:</span> Acompanhe o progresso e atualize o status das atividades.</li>
                        <li><span style="color: var(--primary); font-weight: 600;">4. Análise:</span> Visualize o dashboard e os gráficos de desempenho.</li>
                    </ul>
                </div>
            </div>
        </div>
        <div style="position: absolute; bottom: 20px; color: rgba(255, 255, 255, 0.8); font-size: 0.9rem; text-align: center; width: 100%; z-index: 10;">
            © 2025 - JP Project Manager | Desenvolvido por <span style="font-weight: 700;">@ Juliano Patrick </span>
        </div>
    </div>


    <div id="mainSystem" class="flex h-screen" style="display: none;">
        <aside class="sidebar">
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center">
                    <i data-feather="clipboard" class="h-8 w-8 text-blue-400 mr-3"></i>
                    <h1 class="text-xl font-bold text-white">JP Project Manager</h1>
                </div>
                <p class="text-sm text-gray-300 mt-2">Usuário: <span class="font-medium" id="sidebarUser">N/A</span></p>
                <p class="text-sm text-gray-300 mt-1">Time: <span class="font-medium" id="sidebarFilial">Geral</span></p>
            </div>
            <nav class="p-4">
                
                <a href="#dashboard" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('dashboardView', this)" data-role="admin,gestor,operacao">
                    <i data-feather="bar-chart-2" class="h-5 w-5 mr-3"></i>
                    <span>Dashboard</span>
                </a>
                 <a href="#projects" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('projectsView', this)" data-role="admin,gestor,operacao">
                    <i data-feather="folder-plus" class="h-5 w-5 mr-3"></i>
                    <span>Projetos (CRUD)</span>
                </a>
                 <a href="#agenda" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('agendaView', this)" data-role="admin,gestor,operacao">
                    <i data-feather="calendar" class="h-5 w-5 mr-3"></i>
                    <span>Agenda (Gantt Simples)</span>
                </a>
                 <a href="#personal" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('personalView', this)" data-role="admin,gestor,operacao">
                    <i data-feather="lock" class="h-5 w-5 mr-3"></i>
                    <span>Área Pessoal (Notas)</span>
                </a>
                
                <div class="mt-4 border-t border-gray-700 pt-2">
                    <span class="p-3 text-xs font-semibold text-gray-500 uppercase">Administração</span>
                </div>
                
                <a href="#settings" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('settingsView', this)" data-role="admin">
                    <i data-feather="settings" class="h-5 w-5 mr-3"></i>
                    <span>Configurações</span>
                </a>

                <div id="logoutLink" class="p-3 rounded-lg mt-auto flex items-center text-red-400 cursor-pointer hover:bg-gray-700" onclick="logout()">
                    <i data-feather="log-out" class="h-5 w-5 mr-3"></i>
                    <span>Sair</span>
                </div>
            </nav>
        </aside>

        <main class="flex-1 overflow-auto bg-gray-100 main-content">
            <div class="container mx-auto px-6 py-8">

                <div id="homeView" class="view-content active">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">JP Project Manager</h1>
                    <p class="text-gray-600">Selecione uma opção no menu lateral para começar.</p>
                </div>
                
                <div id="dashboardView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Dashboard de Projetos</h1>
                    <div id="dashboardContent" class="space-y-6">
                        </div>
                    
                    <h3 class="text-2xl font-bold text-gray-800 mt-8 mb-4">Lista de Projetos</h3>
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="form-group">
                                <label for="filterStatus">Filtrar por Status:</label>
                                <select id="filterStatus" class="w-full" onchange="filterProjects()">
                                    <option value="">Todos</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="filterResponsible">Filtrar por Responsável:</label>
                                <select id="filterResponsible" class="w-full" onchange="filterProjects()">
                                    <option value="">Todos</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="filterPriority">Filtrar por Prioridade:</label>
                                <select id="filterPriority" class="w-full" onchange="filterProjects()">
                                    <option value="">Todas</option>
                                    <option value="1">1 - Crítica</option>
                                    <option value="2">2 - Alta</option>
                                    <option value="3">3 - Média</option>
                                    <option value="4">4 - Baixa</option>
                                    <option value="5">5 - Não Importante</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="projectsList" class="space-y-4">
                        </div>
                </div>

                <div id="projectsView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Gerenciar Projetos</h1>
                    
                    <div id="projectMessages" class="mb-4"></div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <h3 class="text-xl font-semibold mb-4" style="color: var(--dark);" id="projectFormTitle">Novo Projeto</h3>
                        <form id="projectForm">
                            <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                                <div class="form-group">
                                    <label for="projectTitle">Título do Projeto:</label>
                                    <input type="text" id="projectTitle" required class="w-full">
                                </div>
                                <div class="form-group">
                                    <label>Responsável(is) Principal(is):</label>
                                    <div class="multi-select-wrapper" id="projectResponsibleWrapper">
                                        <div class="multi-select-display p-3 border rounded-lg bg-gray-50" onclick="toggleMultiSelect('projectResponsibleOptions')">
                                            <div class="multi-select-tags flex flex-wrap gap-1" id="projectResponsibleTags"></div>
                                        </div>
                                        <div class="multi-select-options p-2 bg-white border rounded-b-lg shadow-lg" id="projectResponsibleOptions" style="display:none; position: absolute;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                                <div class="form-group">
                                    <label for="projectPriority">Prioridade:</label>
                                    <select id="projectPriority" class="w-full">
                                        <option value="1">1 - Crítica</option>
                                        <option value="2">2 - Alta</option>
                                        <option value="3" selected>3 - Média</option>
                                        <option value="4">4 - Baixa</option>
                                        <option value="5">5 - Não Importante</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="projectStatus">Status:</label>
                                    <select id="projectStatus" class="w-full">
                                        <option value="nao-iniciado" selected>Não Iniciado</option>
                                        <option value="em-andamento">Em Andamento</option>
                                        <option value="em-pausa">Em Pausa</option>
                                        <option value="concluido">Concluído</option>
                                        <option value="atrasado">Atrasado</option>
                                        <option value="cancelado">Cancelado</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="projectDescription">Descrição:</label>
                                <textarea id="projectDescription" rows="3" class="w-full"></textarea>
                            </div>
                            
                            <h4 class="text-lg font-semibold mb-3 mt-6" style="color: var(--dark);">Atividades do Projeto</h4>
                            <div id="activitiesList" class="space-y-4 border p-4 rounded-lg bg-gray-50">
                                </div>
                            <button type="button" class="btn btn-secondary mt-4" onclick="addActivity()">
                                <i data-feather="plus" class="h-4 w-4 inline-block -mt-1"></i>
                                Adicionar Atividade
                            </button>
                            
                            <h4 class="text-lg font-semibold mb-3 mt-8" style="color: var(--dark);">Anexos</h4>
                            <div class="form-group">
                                <label for="projectAttachments">Anexar Arquivos:</label>
                                <input type="file" id="projectAttachments" multiple class="w-full text-sm">
                                <small class="text-gray-500">Selecione arquivos para anexar ao projeto (apenas para projetos novos ou salvos).</small>
                                <div id="attachedFilesList" class="mt-2 space-y-1"></div>
                            </div>

                            <div class="flex gap-4 mt-6">
                                <button type="button" id="saveProjectBtn" class="btn btn-success flex-1" onclick="saveProject()">
                                    <i data-feather="save" class="h-4 w-4 inline-block -mt-1"></i>
                                    Salvar Projeto
                                </button>
                                <button type="button" class="btn btn-danger flex-1" onclick="clearProjectForm()">
                                    <i data-feather="x" class="h-4 w-4 inline-block -mt-1"></i>
                                    Cancelar / Limpar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="agendaView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Agenda de Atividades</h1>
                    <div id="calendarContainer" class="bg-white p-6 rounded-lg shadow-md" style="height: auto;">
                        <div id="calendar"></div>
                    </div>
                </div>

                <div id="personalView" class="view-content">
                     <h1 class="text-3xl font-bold text-gray-800 mb-6">Área Pessoal</h1>
                    
                    <div id="personalLogin" class="auth-card mx-auto" style="max-width: 400px; background: white; padding: 40px; border: 1px solid #ddd; display: block;">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Acesso Restrito</h2>
                        <p class="text-sm text-gray-600 mb-6">Digite seu usuário e senha para acessar anotações e projetos pessoais.</p>
                         <div id="personalMessages"></div>
                        <div class="form-group">
                            <label for="personalUser">Usuário:</label>
                            <input type="text" id="personalUser" class="w-full">
                        </div>
                        <div class="form-group">
                            <label for="personalPassword">Senha:</label>
                            <input type="password" id="personalPassword" class="w-full">
                        </div>
                        <button class="btn btn-primary w-full" onclick="loginPersonal()">Acessar Área Pessoal</button>
                    </div>

                    <div id="personalContent" style="display: none;" class="space-y-8">
                        <div class="personal-header bg-white p-6 rounded-lg shadow-md flex justify-between items-center">
                            <div>
                                <h2 class="text-2xl font-bold" style="color: var(--accent);">Bem-vindo(a), <span id="currentUser"></span></h2>
                                <p class="text-gray-600">Seus projetos e anotações privadas.</p>
                            </div>
                            <button class="btn btn-danger" onclick="logoutPersonal()">Sair</button>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-bold mb-4 border-b pb-2" style="color: var(--dark);">Meus Projetos (Responsável)</h3>
                                <div id="userProjectsList" class="space-y-4"></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <div class="flex justify-between items-center mb-4 border-b pb-2">
                                    <h3 class="text-xl font-bold" style="color: var(--dark);">Anotações Pessoais</h3>
                                    <button class="btn btn-primary btn-small" onclick="openNoteModal()">
                                        <i data-feather="plus" class="h-4 w-4 inline-block -mt-1"></i> Nova
                                    </button>
                                </div>
                                <div id="notesList" class="space-y-4"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="settingsView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Configurações</h1>
                    <div id="settingsMessages"></div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2" style="color: var(--dark);">Gerenciamento de Usuários</h3>
                        
                        <div class="p-4 border rounded-lg mb-4 bg-gray-50">
                            <h4 class="font-semibold mb-3" style="color: var(--accent);">Adicionar Novo Usuário</h4>
                            <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                                <div class="form-group">
                                    <label for="newUsername">Usuário (Login):</label>
                                    <input type="text" id="newUsername" required class="w-full">
                                </div>
                                <div class="form-group">
                                    <label for="newUserFullName">Nome Completo:</label>
                                    <input type="text" id="newUserFullName" required class="w-full">
                                </div>
                                <div class="form-group">
                                    <label for="newUserPassword">Senha:</label>
                                    <input type="password" id="newUserPassword" required class="w-full">
                                </div>
                                <div class="form-group pt-6">
                                    <button class="btn btn-primary w-full" onclick="addUser()">
                                        <i data-feather="user-plus" class="h-4 w-4 inline-block -mt-1"></i> Adicionar Usuário
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <h4 class="font-semibold mb-3 mt-6" style="color: var(--accent);">Usuários Cadastrados</h4>
                        <div id="usersList" class="space-y-3"></div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2" style="color: var(--dark);">Informações do Sistema</h3>
                        <div id="systemInfo" class="space-y-4"></div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <div id="projectStatusModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 450px;">
            <div class="flex justify-between items-center mb-4">
                 <h3 class="text-xl font-semibold">Atualizar Projeto</h3>
                 <button class="btn btn-danger btn-small" onclick="closeProjectStatusModal()">Fechar</button>
            </div>
            <div id="projectStatusMessages"></div>
            <div class="form-group">
                <label for="editProjectStatus">Status:</label>
                <select id="editProjectStatus" class="w-full">
                    <option value="nao-iniciado">Não Iniciado</option>
                    <option value="em-andamento">Em Andamento</option>
                    <option value="em-pausa">Em Pausa</option>
                    <option value="concluido">Concluído</option>
                    <option value="atrasado">Atrasado</option>
                    <option value="cancelado">Cancelado</option>
                </select>
            </div>
            <div class="form-group">
                <label for="editProjectPriority">Prioridade:</label>
                <select id="editProjectPriority" class="w-full">
                    <option value="1">1 - Crítica</option>
                    <option value="2">2 - Alta</option>
                    <option value="3">3 - Média</option>
                    <option value="4">4 - Baixa</option>
                    <option value="5">5 - Não Importante</option>
                </select>
            </div>
            <button class="btn btn-success w-full mt-4" onclick="saveProjectStatus()">Salvar</button>
        </div>
    </div>
    
    <div id="noteModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <div class="flex justify-between items-center mb-4">
                 <h3 class="text-xl font-semibold">Nova Anotação</h3>
                 <button class="btn btn-danger btn-small" onclick="closeNoteModal()">Fechar</button>
            </div>
            <div id="noteMessages"></div>
            <div class="form-group">
                <label for="noteTitle">Título:</label>
                <input type="text" id="noteTitle" required class="w-full">
            </div>
            <div class="form-group">
                <label for="noteContent">Conteúdo:</label>
                <textarea id="noteContent" rows="6" required class="w-full"></textarea>
            </div>
            <div class="form-group">
                <label class="block mb-2">Cor:</label>
                <div class="flex gap-3">
                    <div class="color-option selected" style="background: #00D4AA;" data-color="#00D4AA" onclick="selectNoteColor(this)"></div>
                    <div class="color-option" style="background: #0077B6;" data-color="#0077B6" onclick="selectNoteColor(this)"></div>
                    <div class="color-option" style="background: #F77F00;" data-color="#F77F00" onclick="selectNoteColor(this)"></div>
                    <div class="color-option" style="background: #D62828;" data-color="#D62828" onclick="selectNoteColor(this)"></div>
                    <div class="color-option" style="background: #7a7a7a;" data-color="#7a7a7a" onclick="selectNoteColor(this)"></div>
                </div>
            </div>
            <button class="btn btn-success w-full mt-4" id="saveNoteBtn" onclick="saveNote()">Salvar Anotação</button>
        </div>
    </div>
    
    <div id="notificationContainer"></div>
    
    <script>
        // Configuração Inicial - Use o Proxy
        const SUPABASE_PROXY_URL = '/api/proxy'; 
        const SUPABASE_URL = 'https://tpxwqerxtzyfrexsbzfc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRweHdxZXJ4dHp5ZnJleHNiemZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczMzkxNDMsImV4cCI6MjA3MjkxNTE0M30.XTt2a8BJhpytLqJIBnYQwnO2JbFRIJ1PkrkRo141Qs0';
        const bucketName = 'project-attachments';
    </script>
    <script src="script.js"></script>
    <script>
        // Inicializar ícones e animações
        feather.replace();
        if (typeof AOS !== 'undefined') {
            AOS.init({ duration: 600, once: true });
        }
    </script>

</body>
</html>
