<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JProjects | Gerenciador de Projetos</title>
    
    <link rel="icon" href="icon.png" type="image/png">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#011627">

    <link rel="stylesheet" href="style.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body class="bg-gray-100 font-sans">

    <div id="loginContainer" class="auth-container" style="background: var(--darker); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; position: relative;">
        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 180, 216, 0.1); backdrop-filter: blur(5px);"></div>
        
        <div class="auth-card" style="max-width: 450px; width: 100%; background: white; padding: 50px 40px; border-radius: 16px; box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);">
            <div class="auth-header" style="text-align: center;">
                <img src="icon.png" class="w-20 h-20 mb-6 mx-auto object-contain" alt="Logo JP Tech">
                <h2 style="color: var(--dark); font-size: 1.8rem; font-weight: 700;">Acesso ao JProjects</h2>
                <p style="color: var(--secondary); font-size: 1rem; margin-bottom: 30px;">Seu hub de produtividade</p>
            </div>
            <form id="loginForm" class="auth-form">
                <div class="form-group" style="margin-bottom: 20px;">
                    <label for="email" style="display: none;">E-mail:</label>
                    <input type="email" id="email" placeholder="E-mail" required style="width: 100%; padding: 14px; border: 1px solid #ccc; border-radius: 8px;">
                </div>
                <div class="form-group" style="margin-bottom: 20px;">
                    <label for="password" style="display: none;">Senha:</label>
                    <input type="password" id="password" placeholder="Senha" required style="width: 100%; padding: 14px; border: 1px solid #ccc; border-radius: 8px;">
                </div>
                <div class="form-group" id="orgSelectGroup" style="display: none; margin-bottom: 30px;">
                    <label for="orgSelect" class="block mb-1 font-semibold text-sm text-gray-700">Selecione o Time:</label>
                    <select id="orgSelect" style="width: 100%; padding: 14px; border: 1px solid #ccc; border-radius: 8px;"></select>
                </div>
                <button type="submit" class="btn btn-primary w-full" style="background: var(--primary-gradient); color: white; padding: 14px; border-radius: 8px; font-weight: 700; font-size: 1rem;">ENTRAR</button>
            </form>
            <div id="loginAlert" class="mt-4" style="text-align: center;"></div>
        </div>
        
        <div style="position: absolute; bottom: 20px; color: rgba(255, 255, 255, 0.8); font-size: 0.9rem; text-align: center; width: 100%; z-index: 10;">
            © 2025 - JProjects | Desenvolvido por <span style="font-weight: 700;">JP Tech Solutions</span>
        </div>
    </div>

    <div id="mainSystem" class="flex h-screen" style="display: none;">
        
        <aside class="sidebar">
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center">
                    <img src="icon.png" class="h-8 w-8 mr-3" alt="Logo JP">
                    <h1 class="text-xl font-bold text-white">JProjects</h1>
                </div>
                <p class="text-sm text-gray-300 mt-2">Usuário: <span class="font-medium" id="sidebarUser">N/A</span></p>
                <p class="text-sm text-gray-300 mt-1">Time: <span class="font-medium" id="sidebarOrg">N/A</span></p>
            </div>
            <nav class="p-4">
                <a href="#dashboard" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('dashboardView', this)">
                    <i data-feather="trending-up" class="h-5 w-5 mr-3"></i> <span>Dashboard</span>
                </a>
                <a href="#projetos" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('projetosView', this)">
                    <i data-feather="trello" class="h-5 w-5 mr-3"></i> <span>Projetos (Kanban)</span>
                </a>
                <a href="#calendario" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('calendarioView', this)">
                    <i data-feather="calendar" class="h-5 w-5 mr-3"></i> <span>Calendário & Gantt</span>
                </a>
                <a href="#notas" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('notasView', this)">
                    <i data-feather="edit-3" class="h-5 w-5 mr-3"></i> <span>Bloco de Notas</span>
                </a>
                
                <div class="mt-4 border-t border-gray-700 pt-2">
                    <span class="p-3 text-xs font-semibold text-gray-500 uppercase">Administração</span>
                </div>
                
                <a href="#time" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('timeView', this)">
                    <i data-feather="users" class="h-5 w-5 mr-3"></i> <span>Gerenciar Time</span>
                </a>
                <a href="#config" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('configView', this)">
                    <i data-feather="settings" class="h-5 w-5 mr-3"></i> <span>Configurações</span>
                </a>
                
                <div id="logoutLink" class="p-3 rounded-lg mt-auto flex items-center text-red-400 cursor-pointer hover:bg-gray-700" onclick="logout()">
                    <i data-feather="log-out" class="h-5 w-5 mr-3"></i>
                    <span>Sair</span>
                </div>
            </nav>
        </aside>

        <main class="flex-1 overflow-auto bg-gray-100 main-content">
            <div class="container mx-auto px-6 py-8">

                <div id="dashboardView" class="view-content active">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Dashboard de Produtividade</h1>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="stat-card-dash"><span class="stat-number" id="dashTotalTasks">0</span><span class="stat-label">Tarefas Ativas</span></div>
                        <div class="stat-card-dash"><span class="stat-number" id="dashCompletedTasks">0</span><span class="stat-label">Tarefas Concluídas (Mês)</span></div>
                        <div class="stat-card-dash"><span class="stat-number" id="dashDueTasks">0</span><span class="stat-label">Tarefas Vencendo Hoje</span></div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold mb-4">Progresso do Projeto (Gantt)</h3>
                            <div class="relative h-96">
                                <canvas id="ganttChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold mb-4">Tarefas por Status</h3>
                            <div class="relative h-96">
                                <canvas id="statusChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="projetosView" class="view-content">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-800">Quadro Kanban</h1>
                        <button class="btn btn-success" onclick="openTaskModal(null, 'todo')">
                            <i data-feather="plus" class="h-4 w-4 inline-block -mt-1 mr-1"></i> Nova Tarefa
                        </button>
                    </div>
                    <div id="kanbanBoard" class="kanban-container">
                        <div class="kanban-column" id="col-todo" data-status="todo">
                            <h3 class="kanban-column-title">A Fazer</h3>
                            <div class="kanban-column-content" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'todo')">
                                </div>
                        </div>
                        <div class="kanban-column" id="col-doing" data-status="doing">
                            <h3 class="kanban-column-title">Em Andamento</h3>
                            <div class="kanban-column-content" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'doing')">
                                </div>
                        </div>
                        <div class="kanban-column" id="col-done" data-status="done">
                            <h3 class="kanban-column-title">Concluído</h3>
                            <div class="kanban-column-content" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'done')">
                                </div>
                        </div>
                    </div>
                </div>

                <div id="calendarioView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Calendário de Entregas</h1>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div id="calendarContainer">
                            </div>
                    </div>
                </div>

                <div id="notasView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Bloco de Notas</h1>
                    <div class="note-container">
                        <div id="noteList" class="note-list">
                            <button class="btn btn-primary w-full" onclick="createNewNote()">+ Nova Nota</button>
                            </div>
                        <div id="noteEditor" class="note-editor">
                            <input type="text" id="noteTitle" placeholder="Título da Nota...">
                            <textarea id="noteBody" placeholder="Comece a escrever..."></textarea>
                            <button class="btn btn-success" onclick="saveNote()">Salvar</button>
                        </div>
                    </div>
                </div>
                
                <div id="timeView" class="view-content">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-800">Gerenciar Time</h1>
                        <button class="btn btn-success" onclick="openInviteModal()">
                            <i data-feather="user-plus" class="h-4 w-4 inline-block -mt-1 mr-1"></i> Convidar Membro
                        </button>
                    </div>
                    <div class="table-container bg-white rounded-lg shadow-md">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Email</th>
                                    <th>Função</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="teamTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>

                <div id="configView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Configurações</h1>
                    </div>

            </div>
        </main>
    </div>

    <div id="taskModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <h3 class="text-xl font-semibold mb-4" id="taskModalTitle">Nova Tarefa</h3>
            <form id="taskForm">
                <input type="hidden" id="taskId">
                <input type="hidden" id="taskStatus">
                
                <div class="form-group mb-4">
                    <label for="taskTitle">Título da Tarefa:</label>
                    <input type="text" id="taskTitle" required class="w-full">
                </div>
                <div class="form-group mb-4">
                    <label for="taskDescription">Descrição:</label>
                    <textarea id="taskDescription" rows="4" class="w-full"></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label for="taskDueDate">Data de Entrega:</label>
                        <input type="date" id="taskDueDate" class="w-full">
                    </div>
                    <div class="form-group">
                        <label for="taskPriority">Prioridade:</label>
                        <select id="taskPriority" class="w-full">
                            <option value="baixa">Baixa</option>
                            <option value="media" selected>Média</option>
                            <option value="alta">Alta</option>
                            <option value="urgente">Urgente</option>
                        </select>
                    </div>
                </div>
                
                <div id="taskAlert" class="mt-4"></div>
                <div class="flex gap-4 mt-6">
                    <button type="submit" class="btn btn-success flex-1">Salvar Tarefa</button>
                    <button type="button" class="btn btn-danger flex-1" onclick="closeModal('taskModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="inviteModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <h3 class="text-xl font-semibold mb-4">Convidar para o Time</h3>
            <form id="inviteForm">
                <div class="form-group mb-4">
                    <label for="inviteEmail">E-mail do Convidado:</label>
                    <input type="email" id="inviteEmail" required class="w-full" placeholder="email@exemplo.com">
                </div>
                <div class="form-group mb-4">
                    <label for="inviteRole">Função:</label>
                    <select id="inviteRole" class="w-full">
                        <option value="membro">Membro (Pode editar tarefas)</option>
                        <option value="admin">Admin (Pode gerenciar time)</option>
                    </select>
                </div>
                <div id="inviteAlert" class="mt-4"></div>
                <div class="flex gap-4 mt-6">
                    <button type="submit" class="btn btn-success flex-1">Enviar Convite</button>
                    <button type="button" class="btn btn-danger flex-1" onclick="closeModal('inviteModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="notificationContainer"></div>

    <script>
        // Configuração Inicial (Reutilizando sua API Proxy)
        const SUPABASE_PROXY_URL = '/api/proxy';
    </script>
    <script src="script.js"></script>
    <script>
        // Inicializar ícones e PWA
        feather.replace();
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => console.log('Service Worker registrado com sucesso:', registration))
                .catch(error => console.log('Falha ao registrar Service Worker:', error));
        }
    </script>
</body>
</html>
